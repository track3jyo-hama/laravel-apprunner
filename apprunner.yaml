version: 1.0
runtime: php81
build:
  commands:
    build:
      - ./build.sh
      - cp -p .env.example .env
      - php artisan key:generate
      - find ./storage -type d -exec chmod 775 {} \;
      - find ./storage -type f -exec chmod 664 {} \;
      - find ./bootstrap/cache -type d -exec chmod 775 {} \;
      - find ./bootstrap/cache -type f -exec chmod 664 {} \;
      - find ./storage -type d -exec chmod g+s {} \;
      - find ./bootstrap/cache -type d -exec chmod g+s {} \;
      - setfacl -R -d -m g::rwx ./storage
      - setfacl -R -d -m g::rwx ./bootstrap/cache
run:
  command: supervisord
  network:
    port: 80
    env: APP_PORT